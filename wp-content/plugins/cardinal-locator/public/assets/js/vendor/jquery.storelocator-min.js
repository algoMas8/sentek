!function(t,e,i,s){"use strict";function o(e,i){L=t(e),this.element=e,this.settings=t.extend({},V,i),this._defaults=V,this._name=r,this.init()}for(var n in bhStoreLocatorWpSettings)bhStoreLocatorWpSettings.hasOwnProperty(n)&&("true"===bhStoreLocatorWpSettings[n]&&(bhStoreLocatorWpSettings[n]=!0),"false"===bhStoreLocatorWpSettings[n]&&(bhStoreLocatorWpSettings[n]=!1));for(var a in bhStoreLocatorMapSettings)bhStoreLocatorMapSettings.hasOwnProperty(a)&&("true"===bhStoreLocatorMapSettings[a]&&(bhStoreLocatorMapSettings[a]=!0),"false"===bhStoreLocatorMapSettings[a]&&(bhStoreLocatorMapSettings[a]=!1));var r="storeLocator";if(void 0===t.fn[r]&&"undefined"!=typeof google){var l="";if("undefined"!=typeof bhStoreLocatorAtts&&void 0!==bhStoreLocatorAtts.datapath&&""!==bhStoreLocatorAtts.datapath)l=bhStoreLocatorAtts.datapath,void 0!==bhStoreLocatorAtts.datatype&&""!==bhStoreLocatorAtts.datatype?bhStoreLocatorWpSettings.datatype=bhStoreLocatorAtts.datatype:bhStoreLocatorWpSettings.datatype="xml";else if("locations"!==bhStoreLocatorWpSettings.datasource&&"cpt"!==bhStoreLocatorWpSettings.datasource||"undefined"==typeof bhStoreLocatorLocations)if("remoteurl"===bhStoreLocatorWpSettings.datasource&&"undefined"!=typeof bhStoreLocatorLocations){var g=bhStoreLocatorLocations;bhStoreLocatorWpSettings.datatype="json"}else"locations"!==bhStoreLocatorWpSettings.datasource&&"cpt"!==bhStoreLocatorWpSettings.datasource||"undefined"!=typeof bhStoreLocatorLocations?bhStoreLocatorWpSettings.datapath&&(l=bhStoreLocatorWpSettings.datapath):(l=bhStoreLocatorWpSettings.admin_ajax,bhStoreLocatorWpSettings.datatype="json");else{var g=bhStoreLocatorLocations;bhStoreLocatorWpSettings.datatype="json"}var c=null;switch(bhStoreLocatorWpSettings.maptype){case"terrain":c=google.maps.MapTypeId.TERRAIN;break;case"hybrid":c=google.maps.MapTypeId.HYBRID;break;case"satellite":c=google.maps.MapTypeId.SATELLITE;break;default:c=google.maps.MapTypeId.ROADMAP}var h=null;!0===bhStoreLocatorWpSettings.mapstyles&&""!==bhStoreLocatorWpSettings.mapstylesfile&&"undefined"!=typeof bhStoreLocatorMapStyles&&(h=JSON.parse(bhStoreLocatorMapStyles));var p=null;!0===bhStoreLocatorWpSettings.replacemarker&&""!==bhStoreLocatorWpSettings.markerimgdimwidth&&""!==bhStoreLocatorWpSettings.markerimgdimheight&&(p={width:parseInt(bhStoreLocatorWpSettings.markerimgdimwidth),height:parseInt(bhStoreLocatorWpSettings.markerimgdimheight)});var d=null;!0===bhStoreLocatorWpSettings.switchactivemarker&&""!==bhStoreLocatorWpSettings.selectedmarkerimgdimwidth&&""!==bhStoreLocatorWpSettings.selectedmarkerimgdimheight&&(d={width:parseInt(bhStoreLocatorWpSettings.selectedmarkerimgdimwidth),height:parseInt(bhStoreLocatorWpSettings.selectedmarkerimgdimheight)});var u=null;!0===bhStoreLocatorWpSettings.originmarker&&""!==bhStoreLocatorWpSettings.originmarkerimgdimwidth&&""!==bhStoreLocatorWpSettings.originmarkerimgdimheight&&(u={width:parseInt(bhStoreLocatorWpSettings.originmarkerimgdimwidth),height:parseInt(bhStoreLocatorWpSettings.originmarkerimgdimheight)});var m=null;!0===bhStoreLocatorWpSettings.customsorting&&(m={method:bhStoreLocatorWpSettings.customsortingmethod,order:bhStoreLocatorWpSettings.customsortingorder,prop:bhStoreLocatorWpSettings.customsortingprop});var S=null;if(!t.isEmptyObject(bhStoreLocatorWpSettings.bhslfilters)){S={};for(var f in bhStoreLocatorWpSettings.bhslfilters)if(bhStoreLocatorWpSettings.bhslfilters.hasOwnProperty(f)){var b=String(f);null!==b&&b.indexOf("bh-sl-filter-key")>-1&&(S[bhStoreLocatorWpSettings.bhslfilters[f]]=bhStoreLocatorWpSettings.bhslfilters[f]+"-filters-container")}}var L,v,y,w,k,D,W,M,C,I,x,F,P,R,_,O,A,T,E,B=[],G=[],N=[],j=[],z={},Q={},q={},U={},V={ajaxData:null,altDistanceNoResult:!!bhStoreLocatorWpSettings.noresultsalt&&bhStoreLocatorWpSettings.noresultsalt,autoComplete:!!bhStoreLocatorWpSettings.autocomplete&&bhStoreLocatorWpSettings.autocomplete,autoCompleteDisableListener:!!bhStoreLocatorWpSettings.autocomplete_listener&&bhStoreLocatorWpSettings.autocomplete_listener,autoCompleteOptions:{},autoGeocode:!!bhStoreLocatorWpSettings.autogeocode&&bhStoreLocatorWpSettings.autogeocode,bounceMarker:!0===bhStoreLocatorWpSettings.bouncemarker||bhStoreLocatorWpSettings.bouncemarker,catMarkers:bhStoreLocatorWpSettings.catimages?bhStoreLocatorWpSettings.catimages:null,dataLocation:l,dataRaw:g||null,dataType:bhStoreLocatorWpSettings.datatype?bhStoreLocatorWpSettings.datatype:"json",debug:!!bhStoreLocatorWpSettings.wp_debug&&bhStoreLocatorWpSettings.wp_debug,defaultLat:bhStoreLocatorWpSettings.defaultlat?parseFloat(bhStoreLocatorWpSettings.defaultlat):null,defaultLng:bhStoreLocatorWpSettings.defaultlng?parseFloat(bhStoreLocatorWpSettings.defaultlng):null,defaultLoc:!!bhStoreLocatorWpSettings.defaultloc&&bhStoreLocatorWpSettings.defaultloc,disableAlphaMarkers:!!bhStoreLocatorWpSettings.disablealphamarkers&&bhStoreLocatorWpSettings.disablealphamarkers,distanceAlert:bhStoreLocatorWpSettings.distancealert?parseInt(bhStoreLocatorWpSettings.distancealert):60,dragSearch:!!bhStoreLocatorWpSettings.dragsearch&&bhStoreLocatorWpSettings.dragsearch,exclusiveFiltering:!!bhStoreLocatorWpSettings.exclusivefiltering&&bhStoreLocatorWpSettings.exclusivefiltering,exclusiveTax:null,featuredLocations:!!bhStoreLocatorWpSettings.featuredlocations&&bhStoreLocatorWpSettings.featuredlocations,fullMapStart:!!bhStoreLocatorWpSettings.fullmapstart&&bhStoreLocatorWpSettings.fullmapstart,fullMapStartBlank:!!bhStoreLocatorWpSettings.fullmapstartblank&&parseInt(bhStoreLocatorWpSettings.fullzoom),fullMapStartListLimit:!!parseInt(0!==bhStoreLocatorWpSettings.fullmapstartlistlimit)&&parseInt(bhStoreLocatorWpSettings.fullmapstartlistlimit),infoBubble:null,inlineDirections:!!bhStoreLocatorWpSettings.inlinedirections&&bhStoreLocatorWpSettings.inlinedirections,lengthUnit:bhStoreLocatorWpSettings.lengthunit?bhStoreLocatorWpSettings.lengthunit:"m",listColor1:bhStoreLocatorWpSettings.listbgcolor?bhStoreLocatorWpSettings.listbgcolor:"#ffffff",listColor2:bhStoreLocatorWpSettings.listbgcolor2?bhStoreLocatorWpSettings.listbgcolor2:"#eeeeee",loading:!!bhStoreLocatorWpSettings.loading&&bhStoreLocatorWpSettings.loading,locationsPerPage:bhStoreLocatorWpSettings.locationsperpage?parseInt(bhStoreLocatorWpSettings.locationsperpage):10,mapSettings:{mapTypeId:c||google.maps.MapTypeId.ROADMAP,styles:null!==h?h:"",zoom:bhStoreLocatorWpSettings.zoom?parseInt(bhStoreLocatorWpSettings.zoom):12},markerCluster:null,markerImg:bhStoreLocatorWpSettings.replacemarker?bhStoreLocatorWpSettings.markerimage:null,markerDim:null!==p?p:null,maxDistance:!!bhStoreLocatorWpSettings.maxdistance&&bhStoreLocatorWpSettings.maxdistance,modal:!!bhStoreLocatorWpSettings.modalwindow&&bhStoreLocatorWpSettings.modalwindow,nameAttribute:bhStoreLocatorWpSettings.nameattribute?bhStoreLocatorWpSettings.nameattribute:"name",nameSearch:!!bhStoreLocatorWpSettings.namesearch&&bhStoreLocatorWpSettings.namesearch,noForm:!!bhStoreLocatorWpSettings.noform&&bhStoreLocatorWpSettings.noform,openNearest:!!bhStoreLocatorWpSettings.opennearest&&bhStoreLocatorWpSettings.opennearest,originMarker:!!bhStoreLocatorWpSettings.originmarker&&bhStoreLocatorWpSettings.originmarker,originMarkerDim:null!==u?u:null,originMarkerImg:bhStoreLocatorWpSettings.originmarkerimg?bhStoreLocatorWpSettings.originmarkerimg:null,pagination:!!bhStoreLocatorWpSettings.pagination&&bhStoreLocatorWpSettings.pagination,querystringParams:!!bhStoreLocatorWpSettings.querystrings&&bhStoreLocatorWpSettings.querystrings,selectedMarkerImg:bhStoreLocatorWpSettings.switchactivemarker?bhStoreLocatorWpSettings.selectedmarkerimg:null,selectedMarkerImgDim:null!==d?d:null,sessionStorage:!0,slideMap:!0===bhStoreLocatorWpSettings.slidemap||bhStoreLocatorWpSettings.slidemap,sortBy:null!==m?m:null,storeLimit:bhStoreLocatorWpSettings.storelimit?parseInt(bhStoreLocatorWpSettings.storelimit):26,taxonomyFilters:null!==S?S:null,visibleMarkersList:!!bhStoreLocatorWpSettings.visiblemarkerslist&&bhStoreLocatorWpSettings.visiblemarkerslist,xmlElement:bhStoreLocatorWpSettings.xmlelement?bhStoreLocatorWpSettings.xmlelement:"marker",addressID:bhStoreLocatorWpSettings.inputid?bhStoreLocatorWpSettings.inputid:"bh-sl-address",closeIcon:bhStoreLocatorWpSettings.modalcloseicondiv?bhStoreLocatorWpSettings.modalcloseicondiv:"bh-sl-close-icon",formContainer:bhStoreLocatorWpSettings.formcontainerdiv?bhStoreLocatorWpSettings.formcontainerdiv:"bh-sl-form-container",formID:bhStoreLocatorWpSettings.formid?bhStoreLocatorWpSettings.formid:"bh-sl-user-location",geocodeID:bhStoreLocatorWpSettings.geocodebtn?bhStoreLocatorWpSettings.geocodebtnid:null,lengthSwapID:bhStoreLocatorWpSettings.lengthswapid?bhStoreLocatorWpSettings.lengthswapid:"bh-sl-length-swap",loadingContainer:bhStoreLocatorWpSettings.loadingdiv?bhStoreLocatorWpSettings.loadingdiv:"bh-sl-loading",locationList:bhStoreLocatorWpSettings.listdiv?bhStoreLocatorWpSettings.listdiv:"bh-sl-loc-list",mapID:bhStoreLocatorWpSettings.mapid?bhStoreLocatorWpSettings.mapid:"bh-sl-map",maxDistanceID:bhStoreLocatorWpSettings.maxdistanceid?bhStoreLocatorWpSettings.maxdistanceid:"bh-sl-maxdistance",modalContent:bhStoreLocatorWpSettings.modalcontentdiv?bhStoreLocatorWpSettings.modalcontentdiv:"bh-sl-modal-content",modalWindow:bhStoreLocatorWpSettings.modalwindowdiv?bhStoreLocatorWpSettings.modalwindowdiv:"bh-sl-modal-window",orderID:bhStoreLocatorWpSettings.customorderid?bhStoreLocatorWpSettings.customorderid:"bh-sl-order",overlay:bhStoreLocatorWpSettings.overlaydiv?bhStoreLocatorWpSettings.overlaydiv:"bh-sl-overlay",regionID:bhStoreLocatorWpSettings.regionid?bhStoreLocatorWpSettings.regionid:"bh-sl-region",searchID:bhStoreLocatorWpSettings.namesearchid?bhStoreLocatorWpSettings.namesearchid:"bh-sl-search",sortID:bhStoreLocatorWpSettings.customsortingid?bhStoreLocatorWpSettings.customsortingid:"bh-sl-sort",taxonomyFiltersContainer:bhStoreLocatorWpSettings.taxonomyfilterscontainer?bhStoreLocatorWpSettings.taxonomyfilterscontainer:"bh-sl-filters-container",infowindowTemplatePath:bhStoreLocatorWpSettings.infowindow_template?bhStoreLocatorWpSettings.infowindow_template:bhStoreLocatorWpSettings.plugin_path+"public/assets/templates/infowindow-description.html",listTemplatePath:bhStoreLocatorWpSettings.list_template?bhStoreLocatorWpSettings.list_template:bhStoreLocatorWpSettings.plugin_path+"public/assets/templates/location-list-description.html",KMLinfowindowTemplatePath:bhStoreLocatorWpSettings.kml_infowindow_template?bhStoreLocatorWpSettings.kml_infowindow_template:bhStoreLocatorWpSettings.plugin_path+"public/assets/templates/kml-infowindow-description.html",KMLlistTemplatePath:bhStoreLocatorWpSettings.kml_list_template?bhStoreLocatorWpSettings.kml_list_template:bhStoreLocatorWpSettings.plugin_path+"public/assets/templates/kml-location-list-description.html",listTemplateID:bhStoreLocatorWpSettings.listid?bhStoreLocatorWpSettings.listid:null,infowindowTemplateID:bhStoreLocatorWpSettings.infowindowid?bhStoreLocatorWpSettings.infowindowid:null,callbackAutoGeoSuccess:null,callbackBeforeSend:null,callbackCloseDirections:null,callbackCreateMarker:null,callbackDirectionsRequest:null,callbackFilters:null,callbackFormVals:null,callbackGeocodeRestrictions:null,callbackJsonp:null,callbackListClick:null,callbackMapSet:null,callbackMarkerClick:null,callbackModalClose:null,callbackModalOpen:null,callbackModalReady:null,callbackNearestLoc:null,callbackNoResults:null,callbackNotify:null,callbackOrder:null,callbackPageChange:null,callbackRegion:null,callbackSorting:null,callbackSuccess:null,addressErrorAlert:bhStoreLocatorWpSettings.addresserror?bhStoreLocatorWpSettings.addresserror:"Unable to find address",autoGeocodeErrorAlert:bhStoreLocatorWpSettings.autogeocodeerror?bhStoreLocatorWpSettings.autogeocodeerror:"Automatic location detection failed. Please fill in your address or zip code.",distanceErrorAlert:bhStoreLocatorWpSettings.distanceerror?bhStoreLocatorWpSettings.distanceerror+" ":"Unfortunately, our closest location is more than ",kilometerLang:bhStoreLocatorWpSettings.kilometerlang?bhStoreLocatorWpSettings.kilometerlang:"kilometer",kilometersLang:bhStoreLocatorWpSettings.kilometerslang?bhStoreLocatorWpSettings.kilometerslang:"kilometers",mileLang:bhStoreLocatorWpSettings.milelang?bhStoreLocatorWpSettings.milelang:"mile",milesLang:bhStoreLocatorWpSettings.mileslang?bhStoreLocatorWpSettings.mileslang:"miles",noResultsTitle:bhStoreLocatorWpSettings.noresultstitle?bhStoreLocatorWpSettings.noresultstitle:"No results",noResultsDesc:bhStoreLocatorWpSettings.noresultsdesc?bhStoreLocatorWpSettings.noresultsdesc:"No locations were found with the given criteria. Please modify your selections or input.",nextPage:bhStoreLocatorWpSettings.nextpage?bhStoreLocatorWpSettings.nextpage:"Next &raquo;",prevPage:bhStoreLocatorWpSettings.prevpage?bhStoreLocatorWpSettings.prevpage:"&laquo; Prev"};t.extend(o.prototype,{init:function(){var e=this;if(this.writeDebug("init"),"km"===this.settings.lengthUnit?q.EarthRadius=6367:q.EarthRadius=3956,w="kml"===this.settings.dataType?"xml":this.settings.dataType,!0===this.settings.inlineDirections&&t("."+this.settings.locationList).prepend('<div class="bh-sl-directions-panel"></div>'),W=this.settings.mapSettings.zoom,Handlebars.registerHelper("niceURL",function(t){if(t)return t.replace("https://","").replace("http://","")}),null!==this.settings.taxonomyFilters&&this.taxonomyFiltering(),this.sorting(),this.order(),!0===this.settings.modal&&(null!==this.settings.taxonomyFilters&&t("."+this.settings.taxonomyFiltersContainer).clone(!0,!0).prependTo(L),L.wrap('<div class="'+this.settings.overlay+'"><div class="'+this.settings.modalWindow+'"><div class="'+this.settings.modalContent+'">'),t("."+this.settings.modalWindow).prepend('<div class="'+this.settings.closeIcon+'"></div>'),t("."+this.settings.overlay).hide()),!0===this.settings.autoComplete){var s=i.getElementById(this.settings.addressID),o=new google.maps.places.Autocomplete(s,this.settings.autoCompleteOptions);!0===this.settings.autoComplete&&!0!==this.settings.autoCompleteDisableListener&&o.addListener("place_changed",function(t){e.processForm(t)})}this._loadTemplates()},destroy:function(){this.writeDebug("destroy"),this.reset();var e=t("#"+this.settings.mapID);if(j.length)for(var s=0;s<=j.length;s++)google.maps.event.removeListener(j[s]);t("."+this.settings.locationList+" ul").empty(),e.hasClass("bh-sl-map-open")&&e.empty().removeClass("bh-sl-map-open"),!0===this.settings.modal&&t(". "+this.settings.overlay).remove(),e.attr("style",""),L.hide(),t.removeData(L.get(0)),t(i).off(r),L.unbind()},reset:function(){if(this.writeDebug("reset"),G=[],B=[],N=[],j=[],T=!1,t(i).off("click."+r,"."+this.settings.locationList+" li"),t("."+this.settings.locationList+" .bh-sl-close-directions-container").length&&t(".bh-sl-close-directions-container").remove(),!0===this.settings.inlineDirections){var e=t("."+this.settings.locationList+" .adp");e.length>0&&(e.remove(),t("."+this.settings.locationList+" ul").fadeIn()),t(i).off("click","."+this.settings.locationList+" li .loc-directions a")}!0===this.settings.pagination&&t(i).off("click."+r,".bh-sl-pagination li")},formFiltersReset:function(){if(this.writeDebug("formFiltersReset"),null!==this.settings.taxonomyFilters){var e=t("."+this.settings.taxonomyFiltersContainer+" input"),i=t("."+this.settings.taxonomyFiltersContainer+" select");"object"==typeof e&&(e.each(function(){(t(this).is('input[type="checkbox"]')||t(this).is('input[type="radio"]'))&&t(this).prop("checked",!1)}),i.each(function(){t(this).prop("selectedIndex",0)}))}},mapReload:function(){this.writeDebug("mapReload"),this.reset(),E=!0,null!==this.settings.taxonomyFilters&&(this.formFiltersReset(),this.taxonomyFiltersInit()),x&&F?(this.settings.mapSettings.zoom=W,this.processForm()):this.mapping(U)},notify:function(t){this.writeDebug("notify",t),"function"==typeof cslNotify?cslNotify.call(this,t):alert(t)},geoCodeCalcToRadian:function(t){return this.writeDebug("geoCodeCalcToRadian",t),t*(Math.PI/180)},geoCodeCalcDiffRadian:function(t,e){return this.writeDebug("geoCodeCalcDiffRadian",arguments),this.geoCodeCalcToRadian(e)-this.geoCodeCalcToRadian(t)},geoCodeCalcCalcDistance:function(t,e,i,s,o){return this.writeDebug("geoCodeCalcCalcDistance",arguments),2*o*Math.asin(Math.min(1,Math.sqrt(Math.pow(Math.sin(this.geoCodeCalcDiffRadian(t,i)/2),2)+Math.cos(this.geoCodeCalcToRadian(t))*Math.cos(this.geoCodeCalcToRadian(i))*Math.pow(Math.sin(this.geoCodeCalcDiffRadian(e,s)/2),2))))},getQueryString:function(t){if(this.writeDebug("getQueryString",t),t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=e.exec(location.search);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))}},getMap:function(){return this.map},_loadTemplates:function(){this.writeDebug("_loadTemplates");var e,i=this,s='<div class="bh-sl-error">Error: Could not load plugin templates. Check the paths and ensure they have been uploaded. Paths will be wrong if you do not run this from a web server.</div>';"kml"===this.settings.dataType&&null===this.settings.listTemplateID&&null===this.settings.infowindowTemplateID?t.when(t.get(this.settings.KMLinfowindowTemplatePath,function(t){e=t,y=Handlebars.compile(e)}),t.get(this.settings.KMLlistTemplatePath,function(t){e=t,v=Handlebars.compile(e)})).then(function(){i.locator()},function(){throw t("."+i.settings.formContainer).append(s),new Error("Could not load storeLocator plugin templates")}):null!==this.settings.listTemplateID&&null!==this.settings.infowindowTemplateID?(y=Handlebars.compile(t("#"+this.settings.infowindowTemplateID).html()),v=Handlebars.compile(t("#"+this.settings.listTemplateID).html()),i.locator()):t.when(t.get(this.settings.infowindowTemplatePath,function(t){e=t,y=Handlebars.compile(e)}),t.get(this.settings.listTemplatePath,function(t){e=t,v=Handlebars.compile(e)})).then(function(){i.locator()},function(){throw t("."+i.settings.formContainer).append(s),new Error("Could not load storeLocator plugin templates")})},locator:function(){this.writeDebug("locator"),!0===this.settings.slideMap&&L.hide(),this._start(),this._formEventHandler()},_formEventHandler:function(){this.writeDebug("_formEventHandler");var e=this;!0===this.settings.noForm?(t(i).on("click."+r,"."+this.settings.formContainer+" button",function(t){e.processForm(t)}),t(i).on("keydown."+r,function(i){13===i.keyCode&&t("#"+e.settings.addressID).is(":focus")&&e.processForm(i)})):t(i).on("submit."+r,"#"+this.settings.formID,function(t){e.processForm(t)}),t(".bh-sl-reset").length&&t("#"+this.settings.mapID).length&&t(i).on("click."+r,".bh-sl-reset",function(){e.mapReload()})},_getData:function(e,i,s,o,n){this.writeDebug("_getData",arguments);var a=this,r="",l="",g="";if(void 0!==o&&void 0!==o.geometry.bounds&&(g=o.formatted_address,r=JSON.stringify(o.geometry.bounds.getNorthEast()),l=JSON.stringify(o.geometry.bounds.getSouthWest())),"function"==typeof cslBeforeSend&&cslBeforeSend.call(this,e,i,s,g,r,l,n),null===a.settings.dataRaw){var c=t.Deferred(),h={};return!0===this.settings.loading&&t("."+this.settings.formContainer).append('<div class="'+this.settings.loadingContainer+'"></div>'),h="locations"!==bhStoreLocatorWpSettings.datasource&&"cpt"!==bhStoreLocatorWpSettings.datasource||"undefined"!=typeof bhStoreLocatorLocations?{origLat:e,origLng:i,origAddress:s,formattedAddress:g,boundsNorthEast:r,boundsSouthWest:l}:{action:"bh_storelocator_posts_query_ajax",postType:bhStoreLocatorWpSettings.posttype,security:bhStoreLocatorWpSettings.ajax_nonce,origLat:e,origLng:i,origAddress:s,postID:bhStoreLocatorWpSettings.post_id,formattedAddress:g,boundsNorthEast:r,boundsSouthWest:l},null!==this.settings.ajaxData&&"object"==typeof this.settings.ajaxData&&t.extend(h,this.settings.ajaxData),"function"==typeof cslAjaxData&&t.extend(h,cslAjaxData.call(this)),t.ajax({type:"GET",url:this.settings.dataLocation+("jsonp"===this.settings.dataType?(this.settings.dataLocation.match(/\?/)?"&":"?")+"callback=?":""),data:h,dataType:w,jsonpCallback:"jsonp"===this.settings.dataType?this.settings.callbackJsonp:null}).done(function(e){c.resolve(e),!0===a.settings.loading&&t("."+a.settings.formContainer+" ."+a.settings.loadingContainer).remove()}).fail(c.reject),c.promise()}return"xml"===w?t.parseXML(a.settings.dataRaw):"json"===w?Array.isArray&&Array.isArray(a.settings.dataRaw)?a.settings.dataRaw:"string"==typeof a.settings.dataRaw?JSON.parse(a.settings.dataRaw):[]:void 0},_start:function(){this.writeDebug("_start");var s,o=this,n=this.settings.autoGeocode;if(!1!==o.settings.fullMapStartBlank){t("#"+o.settings.mapID).addClass("bh-sl-map-open");for(var l in bhStoreLocatorMapSettings)bhStoreLocatorMapSettings.hasOwnProperty(l)&&(this.settings.mapSettings[l]=bhStoreLocatorMapSettings[a]);var g=o.settings.mapSettings;g.zoom=o.settings.fullMapStartBlank,s=new google.maps.LatLng(this.settings.defaultLat,this.settings.defaultLng),g.center=s,o.map=new google.maps.Map(i.getElementById(o.settings.mapID),g),google.maps.event.addDomListener(e,"resize",function(){var t=o.map.getCenter();google.maps.event.trigger(o.map,"resize"),o.map.setCenter(t)}),o.settings.fullMapStartBlank=!1,g.zoom=W}else!0===this.settings.defaultLoc&&this.defaultLocation(),""!==t.trim(t("#"+this.settings.addressID).val())?(o.writeDebug("Using Address Field"),o.processForm(null),n=!1):!0===this.settings.fullMapStart&&(!0===this.settings.querystringParams&&this.getQueryString(this.settings.addressID)||!0===this.settings.querystringParams&&this.getQueryString(this.settings.searchID)||!0===this.settings.querystringParams&&this.getQueryString(this.settings.maxDistanceID)?(o.writeDebug("Using Query String"),this.processForm(null),n=!1):this.mapping(null));!0===this.settings.autoGeocode&&!0===n&&(o.writeDebug("Auto Geo"),o.htmlGeocode()),null!==this.settings.autoGeocode&&(o.writeDebug("Button Geo"),t(i).on("click."+r,"#"+this.settings.geocodeID,function(){o.htmlGeocode()}))},htmlGeocode:function(){this.writeDebug("htmlGeocode",arguments);var t=this;if(!0===t.settings.sessionStorage&&e.sessionStorage&&e.sessionStorage.getItem("myGeo"))return t.writeDebug("Using Session Saved Values for GEO"),t.autoGeocodeQuery(JSON.parse(e.sessionStorage.getItem("myGeo"))),!1;navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(i){t.writeDebug("Current Position Result");var s={coords:{latitude:i.coords.latitude,longitude:i.coords.longitude,accuracy:i.coords.accuracy}};!0===t.settings.sessionStorage&&e.sessionStorage&&e.sessionStorage.setItem("myGeo",JSON.stringify(s)),"function"==typeof cslAutoGeoSuccess&&cslAutoGeoSuccess.call(this,s),t.autoGeocodeQuery(s)},function(e){t._autoGeocodeError(e)})},googleGeocode:function(t){t.writeDebug("googleGeocode",arguments);var e=new google.maps.Geocoder;this.geocode=function(t,i){e.geocode(t,function(t,e){if(e!==google.maps.GeocoderStatus.OK)throw i(null),new Error("Geocode was not successful for the following reason: "+e);var s={};s.latitude=t[0].geometry.location.lat(),s.longitude=t[0].geometry.location.lng(),s.geocodeResult=t[0],i(s)})}},reverseGoogleGeocode:function(t){t.writeDebug("reverseGoogleGeocode",arguments);var e=new google.maps.Geocoder;this.geocode=function(t,i){e.geocode(t,function(t,e){if(e!==google.maps.GeocoderStatus.OK)throw i(null),new Error("Reverse geocode was not successful for the following reason: "+e);if(t[0]){var s={};s.address=t[0].formatted_address,i(s)}})}},roundNumber:function(t,e){return this.writeDebug("roundNumber",arguments),Math.round(t*Math.pow(10,e))/Math.pow(10,e)},isEmptyObject:function(t){this.writeDebug("isEmptyObject",arguments);for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},hasEmptyObjectVals:function(t){this.writeDebug("hasEmptyObjectVals",arguments);var e=!0;for(var i in t)t.hasOwnProperty(i)&&""!==t[i]&&0!==t[i].length&&(e=!1);return e},modalClose:function(){this.writeDebug("modalClose"),"function"==typeof cslModalClose&&cslModalClose.call(this),z={},t("."+this.settings.overlay+" select").prop("selectedIndex",0),t("."+this.settings.overlay+" input").prop("checked",!1),t("."+this.settings.overlay).hide()},_createLocationVariables:function(t){this.writeDebug("_createLocationVariables",arguments);var e;Q={};for(var i in G[t])G[t].hasOwnProperty(i)&&(e=G[t][i],"distance"!==i&&"altdistance"!==i||(e=this.roundNumber(e,2)),Q[i]=e)},sortAlpha:function(t){this.writeDebug("sortAlpha",arguments);var e=this.settings.sortBy.hasOwnProperty("prop")&&void 0!==this.settings.sortBy.prop?this.settings.sortBy.prop:"name";this.settings.sortBy.hasOwnProperty("order")&&"desc"===this.settings.sortBy.order.toString()?t.sort(function(t,i){return i[e].toLowerCase().localeCompare(t[e].toLowerCase())}):t.sort(function(t,i){return t[e].toLowerCase().localeCompare(i[e].toLowerCase())})},sortDate:function(t){this.writeDebug("sortDate",arguments);var e=this.settings.sortBy.hasOwnProperty("prop")&&void 0!==this.settings.sortBy.prop?this.settings.sortBy.prop:"date";this.settings.sortBy.hasOwnProperty("order")&&"desc"===this.settings.sortBy.order.toString()?t.sort(function(t,i){return new Date(i[e]).getTime()-new Date(t[e]).getTime()}):t.sort(function(t,i){return new Date(t[e]).getTime()-new Date(i[e]).getTime()})},sortNumerically:function(t){this.writeDebug("sortNumerically",arguments);var e=null!==this.settings.sortBy&&this.settings.sortBy.hasOwnProperty("prop")&&void 0!==this.settings.sortBy.prop?this.settings.sortBy.prop:"distance";null!==this.settings.sortBy&&this.settings.sortBy.hasOwnProperty("order")&&"desc"===this.settings.sortBy.order.toString()?t.sort(function(t,i){return i[e]<t[e]?-1:i[e]>t[e]?1:0}):t.sort(function(t,i){return t[e]<i[e]?-1:t[e]>i[e]?1:0})},sortCustom:function(t){this.writeDebug("sortCustom",arguments),this.settings.sortBy.hasOwnProperty("method")&&"alpha"===this.settings.sortBy.method.toString()?this.sortAlpha(t):this.settings.sortBy.hasOwnProperty("method")&&"date"===this.settings.sortBy.method.toString()?this.sortDate(t):this.sortNumerically(t)},filterData:function(t,e){this.writeDebug("filterData",arguments);var i=!0;for(var s in e)if(e.hasOwnProperty(s))if(!0===this.settings.exclusiveFiltering||null!==this.settings.exclusiveTax&&Array.isArray(this.settings.exclusiveTax)&&-1!==this.settings.exclusiveTax.indexOf(s)){var o=e[s],n=[];if(void 0!==t[s])for(var a=0;a<o.length;a++)n[a]=new RegExp(o[a],"i").test(t[s].replace(/([^\x00-\x7F]|[.*+?^=!:${}()|\[\]\/\\]|&\s+)/g,""));-1===n.indexOf(!0)&&(i=!1)}else void 0!==t[s]&&new RegExp(e[s].join(""),"i").test(t[s].replace(/([^\x00-\x7F]|[.*+?^=!:${}()|\[\]\/\\]|&\s+)/g,""))||(i=!1);if(i)return!0},_paginationOutput:function(t,e){this.writeDebug("_paginationOutput",arguments),t=parseFloat(t);var i="",s=t+1,o=t-1;t>0&&(i+='<li class="bh-sl-next-prev" data-page="'+o+'">'+this.settings.prevPage+"</li>");for(var n=0;n<Math.ceil(e);n++){var a=n+1;i+=n===t?'<li class="bh-sl-current" data-page="'+n+'">'+a+"</li>":'<li data-page="'+n+'">'+a+"</li>"}return s<e&&(i+='<li class="bh-sl-next-prev" data-page="'+s+'">'+this.settings.nextPage+"</li>"),i},paginationSetup:function(e){this.writeDebug("paginationSetup",arguments);var i,s="",o=t(".bh-sl-pagination-container .bh-sl-pagination");i=-1===this.settings.storeLimit||G.length<this.settings.storeLimit?G.length/this.settings.locationsPerPage:this.settings.storeLimit/this.settings.locationsPerPage,void 0===e&&(e=0),0===o.length?s=this._paginationOutput(e,i):(o.empty(),s=this._paginationOutput(e,i)),o.append(s)},markerImage:function(t,e,i){this.writeDebug("markerImage",arguments);return void 0!==e&&void 0!==i?{url:t,size:new google.maps.Size(e,i),scaledSize:new google.maps.Size(e,i)}:{url:t,size:new google.maps.Size(32,32),scaledSize:new google.maps.Size(32,32)}},createMarker:function(t,e,i,s,o,n){this.writeDebug("createMarker",arguments);var a,r,l,g=[];if(null!==this.settings.catMarkers&&void 0!==n)if(-1!==n.indexOf(",")){g=n.split(",");for(var c=0;c<g.length;c++)g[c]in this.settings.catMarkers&&(r=this.markerImage(this.settings.catMarkers[g[c]][0],parseInt(this.settings.catMarkers[g[c]][1]),parseInt(this.settings.catMarkers[g[c]][2])))}else n in this.settings.catMarkers&&(r=this.markerImage(this.settings.catMarkers[n][0],parseInt(this.settings.catMarkers[n][1]),parseInt(this.settings.catMarkers[n][2])));return null!==this.settings.markerImg&&(r=null===this.settings.markerDim?this.markerImage(this.settings.markerImg):this.markerImage(this.settings.markerImg,this.settings.markerDim.width,this.settings.markerDim.height)),"function"==typeof cslCreateMarker?a=cslCreateMarker.call(this,o,t,s,n):!0===this.settings.disableAlphaMarkers||-1===this.settings.storeLimit||this.settings.storeLimit>26||null!==this.settings.catMarkers||null!==this.settings.markerImg||!0===this.settings.fullMapStart&&!0===T&&(isNaN(this.settings.fullMapStartListLimit)||this.settings.fullMapStartListLimit>26||-1===this.settings.fullMapStartListLimit)?a=new google.maps.Marker({position:t,map:o,draggable:!1,icon:r}):(l={url:"https://mt.googleapis.com/vt/icon/name=icons/spotlight/spotlight-waypoint-b.png&text="+s+"&psize=16&font=fonts/Roboto-Regular.ttf&color=ff333333&ax=44&ay=48"},a=new google.maps.Marker({position:t,map:o,icon:l,draggable:!1})),a},_defineLocationData:function(e,i,s){this.writeDebug("_defineLocationData",arguments);var o="";this._createLocationVariables(e.get("id"));var n,a;Q.distance<=1?"km"===this.settings.lengthUnit?(a=this.settings.kilometerLang,n=this.settings.mileLang):(a=this.settings.mileLang,n=this.settings.kilometerLang):"km"===this.settings.lengthUnit?(a=this.settings.kilometersLang,n=this.settings.milesLang):(a=this.settings.milesLang,n=this.settings.kilometersLang);var r=e.get("id");return o=!0===this.settings.disableAlphaMarkers||-1===this.settings.storeLimit||this.settings.storeLimit>26||!0===this.settings.fullMapStart&&!0===T&&(isNaN(this.settings.fullMapStartListLimit)||this.settings.fullMapStartListLimit>26||-1===this.settings.fullMapStartListLimit)?r+1:s>0?String.fromCharCode("A".charCodeAt(0)+(i+r)):String.fromCharCode("A".charCodeAt(0)+r),{location:[t.extend(Q,{markerid:r,marker:o,altlength:n,length:a,origin:k})]}},listSetup:function(e,i,s){this.writeDebug("listSetup",arguments);var o=this._defineLocationData(e,i,s),n=v(o);t("."+this.settings.locationList+" > ul").append(n)},changeSelectedMarker:function(t){var e;void 0!==A&&A.setIcon(O),e=null===this.settings.selectedMarkerImgDim?this.markerImage(this.settings.selectedMarkerImg):this.markerImage(this.settings.selectedMarkerImg,this.settings.selectedMarkerImgDim.width,this.settings.selectedMarkerImgDim.height),O=t.icon,t.setIcon(e),A=t},createInfowindow:function(e,i,s,o,n){this.writeDebug("createInfowindow",arguments);var a=this,r=this._defineLocationData(e,o,n),l=y(r);"left"===i?(s.setContent(l),s.open(e.get("map"),e)):google.maps.event.addListener(e,"click",function(){s.setContent(l),s.open(e.get("map"),e);var i=e.get("id"),o=t("."+a.settings.locationList+" li[data-markerid="+i+"]");if(o.length>0){"function"==typeof cslMarkerClick&&cslMarkerClick.call(this,e,i,o,G[i]),t("."+a.settings.locationList+" li").removeClass("list-focus"),o.addClass("list-focus");var n=t("."+a.settings.locationList);n.animate({scrollTop:o.offset().top-n.offset().top+n.scrollTop()})}null!==a.settings.selectedMarkerImg&&a.changeSelectedMarker(e)})},autoGeocodeQuery:function(e){this.writeDebug("autoGeocodeQuery",arguments);var i,s=this,o=null,n=t("#"+this.settings.maxDistanceID);!0===this.settings.querystringParams&&this.getQueryString(this.settings.maxDistanceID)?(o=this.getQueryString(this.settings.maxDistanceID),""!==n.val()&&(o=n.val())):!0===this.settings.maxDistance&&(o=n.val()||"");var a=new this.reverseGoogleGeocode(this),r=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);a.geocode({latLng:r},function(n){null!==n?(i=I=n.address,x=U.lat=e.coords.latitude,F=U.lng=e.coords.longitude,U.origin=i,U.distance=o,s.mapping(U),void 0!==i&&t("#"+s.settings.addressID).val(i)):s.notify(s.settings.addressErrorAlert)})},_autoGeocodeError:function(){this.writeDebug("_autoGeocodeError"),
this.notify(this.settings.autoGeocodeErrorAlert)},defaultLocation:function(){this.writeDebug("defaultLocation");var e,i=this,s=null,o=t("#"+this.settings.maxDistanceID);!0===this.settings.querystringParams&&this.getQueryString(this.settings.maxDistanceID)?(s=this.getQueryString(this.settings.maxDistanceID),""!==o.val()&&(s=o.val())):!0===this.settings.maxDistance&&(s=o.val()||"");var n=new this.reverseGoogleGeocode(this),a=new google.maps.LatLng(this.settings.defaultLat,this.settings.defaultLng);n.geocode({latLng:a},function(t){null!==t?(e=I=t.address,x=U.lat=i.settings.defaultLat,F=U.lng=i.settings.defaultLng,U.distance=s,U.origin=e,i.mapping(U)):i.notify(i.settings.addressErrorAlert)})},paginationChange:function(t){this.writeDebug("paginationChange",arguments),"function"==typeof cslPageChange&&cslPageChange.call(this,t),U.page=t,this.mapping(U)},getAddressByMarker:function(t){this.writeDebug("getAddressByMarker",arguments);var e="";return G[t].address&&(e+=G[t].address+" "),G[t].address2&&(e+=G[t].address2+" "),G[t].city&&(e+=G[t].city+", "),G[t].state&&(e+=G[t].state+" "),G[t].postal&&(e+=G[t].postal+" "),G[t].country&&(e+=G[t].country+" "),e},clearMarkers:function(){this.writeDebug("clearMarkers");var t=null;t=G.length<this.settings.storeLimit?G.length:this.settings.storeLimit;for(var e=0;e<t;e++)j[e].setMap(null)},directionsRequest:function(e,s,o){this.writeDebug("directionsRequest",arguments),"function"==typeof cslDirectionsRequest&&cslDirectionsRequest.call(this,e,s,o,G[s]);var n=this.getAddressByMarker(s);if(n){t("."+this.settings.locationList+" ul").hide(),this.clearMarkers(),null!==R&&void 0!==R&&(R.setMap(null),R=null),R=new google.maps.DirectionsRenderer,_=new google.maps.DirectionsService,R.setMap(o),R.setPanel(t(".bh-sl-directions-panel").get(0));var a={origin:e,destination:n,travelMode:google.maps.TravelMode.DRIVING};_.route(a,function(t,e){e===google.maps.DirectionsStatus.OK&&R.setDirections(t)}),t("."+this.settings.locationList).prepend('<div class="bh-sl-close-directions-container"><div class="'+this.settings.closeIcon+'"></div></div>')}t(i).off("click","."+this.settings.locationList+" li .loc-directions a")},closeDirections:function(){this.writeDebug("closeDirections"),"function"==typeof cslCloseDirections&&cslCloseDirections.call(this),this.reset(),x&&F&&(0===this.countFilters()?this.settings.mapSettings.zoom=W:this.settings.mapSettings.zoom=0,this.processForm(null)),t(i).off("click."+r,"."+this.settings.locationList+" .bh-sl-close-icon")},lengthUnitSwap:function(e){this.writeDebug("lengthUnitSwap",arguments),"alt-distance"===e.val()?(t("."+this.settings.locationList+" .loc-alt-dist").show(),t("."+this.settings.locationList+" .loc-default-dist").hide()):"default-distance"===e.val()&&(t("."+this.settings.locationList+" .loc-default-dist").show(),t("."+this.settings.locationList+" .loc-alt-dist").hide())},processForm:function(e){this.writeDebug("processForm",arguments);var i=this,s=null,o={},n=t("#"+this.settings.addressID),a=t("#"+this.settings.searchID),r=t("#"+this.settings.maxDistanceID),l="";if(void 0!==e&&null!==e&&e.preventDefault(),t("."+i.settings.formContainer+" input, ."+i.settings.formContainer+" select").blur(),!0===this.settings.querystringParams&&(this.getQueryString(this.settings.addressID)||this.getQueryString(this.settings.searchID)||this.getQueryString(this.settings.maxDistanceID))?(I=this.getQueryString(this.settings.addressID),C=this.getQueryString(this.settings.searchID),s=this.getQueryString(this.settings.maxDistanceID),""!==n.val()&&(I=n.val()),""!==a.val()&&(C=a.val()),""!==r.val()&&(s=r.val())):(I=n.val()||"",C=a.val()||"",!0===this.settings.maxDistance&&(s=r.val()||"")),l="function"==typeof cslRegion?cslRegion.call(this,I,C,s):t("#"+this.settings.regionID).val(),"function"==typeof cslFormVals&&cslFormVals.call(this,I,C,s,l),void 0!==l&&(o={country:l}),"function"==typeof cslGeocodeRestrictions&&(o=cslGeocodeRestrictions.call(this,I,C,s)),""===I&&""===C&&!0!==this.settings.autoGeocode)this._start();else if(""!==I)if(void 0!==k&&void 0!==x&&void 0!==F&&I===k)U.lat=x,U.lng=F,U.origin=I,U.name=C,U.distance=s,i.mapping(U);else{var g=new this.googleGeocode(this);g.geocode({address:I,componentRestrictions:o,region:l},function(t){null!==t?(x=t.latitude,F=t.longitude,U.lat=x,U.lng=F,U.origin=I,U.name=C,U.distance=s,U.geocodeResult=t.geocodeResult,i.mapping(U)):i.notify(i.settings.addressErrorAlert)})}else""!==C?(""===I&&delete U.origin,U.name=C,i.mapping(U)):!0===this.settings.autoGeocode&&(U.lat=x,U.lng=F,U.origin=I,U.name=C,U.distance=s,i.mapping(U))},locationsSetup:function(t,e,i,s,o){if(this.writeDebug("locationsSetup",arguments),void 0!==s&&(t.distance||(t.distance=this.geoCodeCalcCalcDistance(e,i,t.lat,t.lng,q.EarthRadius),"m"===this.settings.lengthUnit?t.altdistance=1.609344*parseFloat(t.distance):"km"===this.settings.lengthUnit&&(t.altdistance=parseFloat(t.distance)/1.609344))),!0===this.settings.maxDistance&&void 0!==o&&null!==o){if(!(t.distance<=o))return;G.push(t)}else if(!0===this.settings.maxDistance&&!0===this.settings.querystringParams&&void 0!==o&&null!==o){if(!(t.distance<=o))return;G.push(t)}else G.push(t)},sorting:function(){this.writeDebug("sorting",arguments);var e=this,i=t("#"+e.settings.mapID),s=t("#"+e.settings.sortID);0!==s.length&&s.on("change."+r,function(s){s.stopPropagation(),!0===e.settings.pagination&&e.paginationChange(0);var o,n;o=void 0!==t(this).find(":selected").attr("data-method")?t(this).find(":selected").attr("data-method"):"distance",n=t(this).val(),e.settings.sortBy.method=o,e.settings.sortBy.prop=n,"function"==typeof cslSorting&&cslSorting.call(this,e.settings.sortBy),i.hasClass("bh-sl-map-open")&&e.mapping(U)})},order:function(){this.writeDebug("order",arguments);var e=this,i=t("#"+e.settings.mapID),s=t("#"+e.settings.orderID);0!==s.length&&s.on("change."+r,function(s){s.stopPropagation(),!0===e.settings.pagination&&e.paginationChange(0),e.settings.sortBy.order=t(this).val(),"function"==typeof cslOrder&&cslOrder.call(this,e.settings.order),i.hasClass("bh-sl-map-open")&&e.mapping(U)})},countFilters:function(){this.writeDebug("countFilters");var t=0;if(!this.isEmptyObject(z))for(var e in z)z.hasOwnProperty(e)&&(t+=z[e].length);return t},_existingCheckedFilters:function(e){this.writeDebug("_existingCheckedFilters",arguments),t("#"+this.settings.taxonomyFilters[e]+" input[type=checkbox]").each(function(){if(t(this).prop("checked")){var i=t(this).val();void 0!==i&&""!==i&&-1===z[e].indexOf(i)&&z[e].push(i)}})},_existingSelectedFilters:function(e){this.writeDebug("_existingSelectedFilters",arguments),t("#"+this.settings.taxonomyFilters[e]+" select").each(function(){var i=t(this).val();void 0!==i&&""!==i&&-1===z[e].indexOf(i)&&(z[e]=[i])})},_existingRadioFilters:function(e){this.writeDebug("_existingRadioFilters",arguments),t("#"+this.settings.taxonomyFilters[e]+" input[type=radio]").each(function(){if(t(this).prop("checked")){var i=t(this).val();void 0!==i&&""!==i&&-1===z[e].indexOf(i)&&(z[e]=[i])}})},checkFilters:function(){this.writeDebug("checkFilters");for(var t in this.settings.taxonomyFilters)this.settings.taxonomyFilters.hasOwnProperty(t)&&(this._existingCheckedFilters(t),this._existingSelectedFilters(t),this._existingRadioFilters(t))},selectQueryStringFilters:function(e,i){this.writeDebug("selectQueryStringFilters",arguments);var s=t("#"+this.settings.taxonomyFilters[e]);if(s.find('input[type="checkbox"]').length)for(var o=0;o<i.length;o++)s.find('input:checkbox[value="'+i[o]+'"]').prop("checked",!0);s.find("select").length&&s.find('option[value="'+i[0]+'"]').prop("selected",!0),s.find('input[type="radio"]').length&&s.find('input:radio[value="'+i[0]+'"]').prop("checked",!0)},checkQueryStringFilters:function(){this.writeDebug("checkQueryStringFilters",arguments);for(var t in z)if(z.hasOwnProperty(t)){var e=this.getQueryString(t);-1!==e.indexOf(",")&&(e=e.split(",")),void 0!==e&&""!==e&&-1===z[t].indexOf(e)&&(Array.isArray(e)?z[t]=e:z[t]=[e]),z[t].length&&this.selectQueryStringFilters(t,z[t])}},getFilterKey:function(t){this.writeDebug("getFilterKey",arguments);for(var e in this.settings.taxonomyFilters)if(this.settings.taxonomyFilters.hasOwnProperty(e))for(var i=0;i<this.settings.taxonomyFilters[e].length;i++)if(this.settings.taxonomyFilters[e]===t)return e},taxonomyFiltersInit:function(){this.writeDebug("taxonomyFiltersInit");for(var t in this.settings.taxonomyFilters)this.settings.taxonomyFilters.hasOwnProperty(t)&&(z[t]=[])},taxonomyFiltering:function(){this.writeDebug("taxonomyFiltering");var e=this;e.taxonomyFiltersInit(),e.checkQueryStringFilters(),t("."+this.settings.taxonomyFiltersContainer).on("change."+r,"input, select",function(i){i.stopPropagation();var s,o,n;if(!0===e.settings.pagination&&e.paginationChange(0),t(this).is('input[type="checkbox"]')){if(e.checkFilters(),s=t(this).val(),o=t(this).closest(".bh-sl-filters").attr("id"),n=e.getFilterKey(o))if(t(this).prop("checked"))-1===z[n].indexOf(s)&&z[n].push(s),!0===t("#"+e.settings.mapID).hasClass("bh-sl-map-open")&&(x&&F?(e.settings.mapSettings.zoom=0,e.processForm()):e.mapping(U));else{var a=z[n].indexOf(s);a>-1&&(z[n].splice(a,1),!0===t("#"+e.settings.mapID).hasClass("bh-sl-map-open")&&(x&&F?(0===e.countFilters()?e.settings.mapSettings.zoom=W:e.settings.mapSettings.zoom=0,e.processForm()):e.mapping(U)))}}else(t(this).is("select")||t(this).is('input[type="radio"]'))&&(e.checkFilters(),s=t(this).val(),o=t(this).closest(".bh-sl-filters").attr("id"),n=e.getFilterKey(o),s?n&&(z[n]=[s],!0===t("#"+e.settings.mapID).hasClass("bh-sl-map-open")&&(x&&F?(e.settings.mapSettings.zoom=0,e.processForm()):e.mapping(U))):(n&&(z[n]=[]),e.reset(),x&&F?(e.settings.mapSettings.zoom=W,e.processForm()):e.mapping(U)))})},checkVisibleMarkers:function(e,i){this.writeDebug("checkVisibleMarkers",arguments);var s,o=this;t("."+this.settings.locationList+" ul").empty(),t(e).each(function(e,n){i.getBounds().contains(n.getPosition())&&(o.listSetup(n,0,0),s=v(void 0),t("."+o.settings.locationList+" > ul").append(s))}),t("."+this.settings.locationList+" ul li:even").css("background",this.settings.listColor1),t("."+this.settings.locationList+" ul li:odd").css("background",this.settings.listColor2)},dragSearch:function(t){this.writeDebug("dragSearch",arguments);var e,i=t.getCenter(),s=this;this.settings.mapSettings.zoom=t.getZoom(),x=U.lat=i.lat(),F=U.lng=i.lng();var o=new this.reverseGoogleGeocode(this);e=new google.maps.LatLng(U.lat,U.lng),o.geocode({latLng:e},function(t){null!==t?(U.origin=I=t.address,s.mapping(U)):s.notify(s.settings.addressErrorAlert)})},emptyResult:function(){this.writeDebug("emptyResult",arguments);for(var e in bhStoreLocatorMapSettings)bhStoreLocatorMapSettings.hasOwnProperty(e)&&(this.settings.mapSettings[e]=bhStoreLocatorMapSettings[a]);var s,o,n=t("."+this.settings.locationList+" ul"),r=this.settings.mapSettings;this.map=new google.maps.Map(i.getElementById(this.settings.mapID),r),"function"==typeof cslNoResults&&cslNoResults.call(this,this.map,r),n.empty(),o=t('<li><div class="bh-sl-noresults-title">'+this.settings.noResultsTitle+'</div><br><div class="bh-sl-noresults-desc">'+this.settings.noResultsDesc+"</li>").hide().fadeIn(),n.append(o),s=x&&F?new google.maps.LatLng(x,F):new google.maps.LatLng(0,0),this.map.setCenter(s),W&&this.map.setZoom(W)},originMarker:function(t,e,i){if(this.writeDebug("originMarker",arguments),!0===this.settings.originMarker){var s="";void 0!==e&&(s=null!==this.settings.originMarkerImg?null===this.settings.originMarkerDim?this.markerImage(this.settings.originMarkerImg):this.markerImage(this.settings.originMarkerImg,this.settings.originMarkerDim.width,this.settings.originMarkerDim.height):{url:"https://mt.googleapis.com/vt/icon/name=icons/spotlight/spotlight-waypoint-a.png"},new google.maps.Marker({position:i,map:t,icon:s,draggable:!1}))}},modalWindow:function(){if(this.writeDebug("modalWindow"),!0===this.settings.modal){var e=this;"function"==typeof cslModalOpen&&cslModalOpen.call(this),t("."+e.settings.overlay).fadeIn(),t(i).on("click."+r,"."+e.settings.closeIcon+", ."+e.settings.overlay,function(){e.modalClose()}),t(i).on("click."+r,"."+e.settings.modalWindow,function(t){t.stopPropagation()}),t(i).on("keyup."+r,function(t){27===t.keyCode&&e.modalClose()})}},openNearestLocation:function(e,i,s,o){if(this.writeDebug("openNearestLocation",arguments),!(!0!==this.settings.openNearest||void 0===e||!0===this.settings.fullMapStart&&!0===T||!0===this.settings.defaultLoc&&!0===T)){var n=this;"function"==typeof cslNearestLoc&&cslNearestLoc.call(this,n.map,e,i,s,o);var a=j[0];n.createInfowindow(a,"left",i,s,o);var r=t("."+n.settings.locationList),l=t("."+n.settings.locationList+" li[data-markerid=0]");t("."+n.settings.locationList+" li").removeClass("list-focus"),l.addClass("list-focus"),r.animate({scrollTop:l.offset().top-r.offset().top+r.scrollTop()})}},listClick:function(e,s,o,n){this.writeDebug("listClick",arguments);var a=this;t(i).on("click."+r,"."+a.settings.locationList+" li",function(){var i=t(this).data("markerid"),r=j[i];"function"==typeof cslListClick&&cslListClick.call(this,i,r,G[i],e),e.panTo(r.getPosition());!0===a.settings.bounceMarker?(r.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){r.setAnimation(null),a.createInfowindow(r,"left",s,o,n)},700)):a.createInfowindow(r,"left",s,o,n),null!==a.settings.selectedMarkerImg&&a.changeSelectedMarker(r),t("."+a.settings.locationList+" li").removeClass("list-focus"),t("."+a.settings.locationList+" li[data-markerid="+i+"]").addClass("list-focus")}),t(i).on("click."+r,"."+a.settings.locationList+" li a",function(t){t.stopPropagation()})},resultsTotalCount:function(e){this.writeDebug("resultsTotalCount",arguments);var i=t(".bh-sl-total-results");void 0===e||e<=0||0===i.length||i.text(e)},inlineDirections:function(e,s){if(this.writeDebug("inlineDirections",arguments),!0===this.settings.inlineDirections&&void 0!==s){var o=this;t(i).on("click."+r,"."+o.settings.locationList+" li .loc-directions a",function(n){n.preventDefault();var a=t(this).closest("li").attr("data-markerid");o.directionsRequest(s,parseInt(a),e),t(i).on("click."+r,"."+o.settings.locationList+" .bh-sl-close-icon",function(){o.closeDirections()})})}},visibleMarkersList:function(t,e){if(this.writeDebug("visibleMarkersList",arguments),!0===this.settings.visibleMarkersList){var i=this;google.maps.event.addListenerOnce(t,"idle",function(){i.checkVisibleMarkers(e,t)}),google.maps.event.addListener(t,"center_changed",function(){i.checkVisibleMarkers(e,t)}),google.maps.event.addListener(t,"zoom_changed",function(){i.checkVisibleMarkers(e,t)})}},mapping:function(t){this.writeDebug("mapping",arguments);var e,i,s,o,n,a,r=this;this.isEmptyObject(t)||(e=t.lat,i=t.lng,s=t.geocodeResult,o=t.origin,a=t.page),!0===r.settings.pagination&&(void 0!==a&&k===I||(a=0)),void 0===o&&!0===this.settings.nameSearch?M=r._getData():(n=new google.maps.LatLng(e,i),void 0!==k&&o===k&&void 0!==D?(o=k,M=D):M=r._getData(x,F,o,s,t)),null!==r.settings.taxonomyFilters&&r.hasEmptyObjectVals(z)&&r.checkFilters(),null!==r.settings.dataRaw?r.processData(t,n,M,a):M.done(function(e){r.processData(t,n,e,a)})},processData:function(s,o,n,l){this.writeDebug("processData",arguments);var g,c,h,p,d,u,m,S,f,b,v,y,w,I=this,x=0,F={},R=t("#"+I.settings.lengthSwapID);this.isEmptyObject(s)||(g=s.lat,c=s.lng,h=s.origin,s.name,p=s.distance);var _=t("#"+I.settings.mapID),O="km"===I.settings.lengthUnit?I.settings.kilometersLang:I.settings.milesLang;if(D=M,void 0!==h&&(k=h),"function"==typeof cslSuccess&&cslSuccess.call(this,s,o,n,l),v=_.hasClass("bh-sl-map-open"),!0===I.settings.fullMapStart&&!1===v||!0===I.settings.autoGeocode&&!1===v||!0===I.settings.defaultLoc&&!1===v||!0===E?T=!0:I.reset(),_.addClass("bh-sl-map-open"),"json"===I.settings.dataType||"jsonp"===I.settings.dataType)for(var A=0;x<n.length;A++){var Q=n[A],q={};for(var U in Q)Q.hasOwnProperty(U)&&(q[U]=Q[U]);I.locationsSetup(q,g,c,h,p),x++}else"kml"===I.settings.dataType?t(n).find("Placemark").each(function(){var e={name:t(this).find("name").text(),lat:t(this).find("coordinates").text().split(",")[1],lng:t(this).find("coordinates").text().split(",")[0],description:t(this).find("description").text()};I.locationsSetup(e,g,c,h,p),x++}):t(n).find(I.settings.xmlElement).each(function(){var t={};for(var e in this.attributes)this.attributes.hasOwnProperty(e)&&(t[this.attributes[e].name]=this.attributes[e].value);I.locationsSetup(t,g,c,h,p),x++});if(!0===I.settings.nameSearch&&void 0!==C&&(z[I.settings.nameAttribute]=[C]),null!==I.settings.taxonomyFilters||!0===I.settings.nameSearch){for(var V in z)if(z.hasOwnProperty(V)&&z[V].length>0)for(var H=0;H<z[V].length;H++)F[V]||(F[V]=[]),F[V][H]="(?=.*\\b"+z[V][H].replace(/([^\x00-\x7F]|[.*+?^=!:${}()|\[\]\/\\]|&\s+)/g,"")+"\\b)";I.isEmptyObject(F)||(G=t.grep(G,function(t){return I.filterData(t,F)}))}if(null!==I.settings.sortBy&&"object"==typeof I.settings.sortBy)I.sortCustom(G);else{if(void 0!==h&&I.sortNumerically(G),I.isEmptyObject(F))if(!0===I.settings.maxDistance&&p)(void 0===G[0]||G[0].distance>p)&&I.notify(I.settings.distanceErrorAlert+p+" "+O);else{if(void 0===G[0])throw new Error("No locations found. If you have added locations try deactivating and reactivating the plugin.");-1!==I.settings.distanceAlert&&G[0].distance>I.settings.distanceAlert&&(I.notify(I.settings.distanceErrorAlert+I.settings.distanceAlert+" "+O),b=!0)}void 0!==G[0]&&(w=G[0])}if(!0===I.settings.featuredLocations&&(B=t.grep(G,function(t){return"true"===t.featured}),N=t.grep(G,function(t){return"true"!==t.featured}),G=[],G=B.concat(N)),!0===I.settings.slideMap&&L.slideDown(),!0===I.settings.pagination&&I.paginationSetup(l),!0===I.settings.altDistanceNoResult&&w.distance>I.settings.distanceAlert)return void I.emptyResult();if(I.isEmptyObject(G)||"none"===G[0].result)return void I.emptyResult();I.modalWindow(),P=-1===I.settings.storeLimit||G.length<I.settings.storeLimit||!0===this.settings.fullMapStart&&!0===T&&(!isNaN(this.settings.fullMapStartListLimit)||this.settings.fullMapStartListLimit>26||-1===this.settings.fullMapStartListLimit)?G.length:I.settings.storeLimit,!0===I.settings.pagination?(S=I.settings.locationsPerPage,m=l*I.settings.locationsPerPage,m+S>G.length&&(S=I.settings.locationsPerPage-(m+S-G.length)),G=G.slice(m,m+S),P=G.length):(S=P,m=0),I.resultsTotalCount(G.length);for(var K in bhStoreLocatorMapSettings)bhStoreLocatorMapSettings.hasOwnProperty(K)&&(I.settings.mapSettings[K]=bhStoreLocatorMapSettings[a]);if(!0===I.settings.fullMapStart&&!0===T&&!0!==I.settings.querystringParams||0===I.settings.mapSettings.zoom||void 0===h||!0===b)f=I.settings.mapSettings,u=new google.maps.LatLngBounds;else if(!0===I.settings.pagination){var J=new google.maps.LatLng(G[0].lat,G[0].lng);0===l?(I.settings.mapSettings.center=o,f=I.settings.mapSettings):(I.settings.mapSettings.center=J,f=I.settings.mapSettings)}else I.settings.mapSettings.center=o,f=I.settings.mapSettings;if(I.map=new google.maps.Map(i.getElementById(I.settings.mapID),f),google.maps.event.addDomListener(e,"resize",function(){var t=I.map.getCenter();google.maps.event.trigger(I.map,"resize"),I.map.setCenter(t)}),!0===I.settings.dragSearch&&I.map.addListener("dragend",function(){I.dragSearch(I.map)}),L.data(I.settings.mapID.replace("#",""),I.map),"function"==typeof cslMapSet&&cslMapSet.call(this,I.map,o,W,f),"undefined"!=typeof InfoBubble&&null!==I.settings.infoBubble){var $=I.settings.infoBubble;$.map=I.map,y=new InfoBubble($)}else y=new google.maps.InfoWindow;I.originMarker(I.map,h,o),t(i).on("click."+r,".bh-sl-pagination li",function(e){e.preventDefault(),I.paginationChange(t(this).attr("data-page"))}),I.inlineDirections(I.map,h);for(var Z=0;Z<=S-1;Z++){var X="";X=l>0?String.fromCharCode("A".charCodeAt(0)+(m+Z)):String.fromCharCode("A".charCodeAt(0)+Z);var Y=new google.maps.LatLng(G[Z].lat,G[Z].lng);d=I.createMarker(Y,G[Z].name,G[Z].address,X,I.map,G[Z].bh_sl_loc_cat),d.set("id",Z),j[Z]=d,(!0===I.settings.fullMapStart&&!0===T&&!0!==I.settings.querystringParams||0===I.settings.mapSettings.zoom||void 0===h||!0===b)&&u.extend(Y),I.createInfowindow(d,null,y,m,l)}if((!0===I.settings.fullMapStart&&!0===T&&!0!==I.settings.querystringParams||0===I.settings.mapSettings.zoom||void 0===h||!0===b)&&I.map.fitBounds(u),t("."+I.settings.locationList+" ul").empty(),T&&!1!==I.settings.fullMapStartListLimit&&!isNaN(I.settings.fullMapStartListLimit)&&-1!==I.settings.fullMapStartListLimit)for(var tt=0;tt<I.settings.fullMapStartListLimit;tt++){var et=j[tt];I.listSetup(et,m,l)}else t(j).each(function(t){var e=j[t];I.listSetup(e,m,l)});if(R.length&&(I.lengthUnitSwap(R),R.on("change."+r,function(t){t.stopPropagation(),I.lengthUnitSwap(R)})),I.openNearestLocation(w,y,m,l),"undefined"!=typeof MarkerClusterer&&null!==I.settings.markerCluster){new MarkerClusterer(I.map,j,I.settings.markerCluster)}I.listClick(I.map,y,m,l),t("."+I.settings.locationList+" ul > li:even").css("background",I.settings.listColor1),t("."+I.settings.locationList+" ul > li:odd").css("background",I.settings.listColor2),I.visibleMarkersList(I.map,j),!0===I.settings.modal&&"function"==typeof cslModalReady&&cslModalReady.call(this,s),"function"==typeof cslFilters&&cslFilters.call(this,z,s)},writeDebug:function(){e.console&&this.settings.debug&&(Function.prototype.bind?this.writeDebug=Function.prototype.bind.call(console.log,console,"StoreLocator :"):this.writeDebug=function(){arguments[0]="StoreLocator : "+arguments[0],Function.prototype.apply.call(console.log,console,arguments)},this.writeDebug.apply(this,arguments))}}),t.fn[r]=function(e){var i=arguments;if(void 0===e||"object"==typeof e)return this.each(function(){t.data(this,"plugin_"+r)||t.data(this,"plugin_"+r,new o(this,e))});if("string"==typeof e&&"_"!==e[0]&&"init"!==e){var s;return this.each(function(){var n=t.data(this,"plugin_"+r);n instanceof o&&"function"==typeof n[e]&&(s=n[e].apply(n,Array.prototype.slice.call(i,1))),"destroy"===e&&t.data(this,"plugin_"+r,null)}),void 0!==s?s:this}}}}(jQuery,window,document);